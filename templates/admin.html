<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>하루마틴 관리자 페이지</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'pretendard': ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'sans-serif'],
                    },
                    colors: {
                        'bg-main': '#F5F4EF',
                        'text-main': '#1F2D3D',
                        'text-sub': '#B0B8C1',
                        'accent': '#2E8B8B',
                        'accent-hover': '#236B6B',
                    }
                }
            }
        }
    </script>
</head>
<body class="font-pretendard bg-bg-main text-text-main">
    <!-- 상단 헤더 -->
    <header class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-md border-b border-gray-200 z-50">
        <div class="flex items-center justify-between px-8 py-4">
            <div class="flex items-center space-x-6">
                <a href="/" class="text-text-main hover:text-accent transition-colors p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-arrow-left text-lg"></i>
                </a>
                <div class="flex items-center space-x-3">
                    <h1 class="text-xl font-semibold text-text-main">하루마틴 관리자</h1>
                </div>
            </div>
            <button class="flex items-center space-x-2 px-4 py-2 text-text-sub hover:text-text-main rounded-lg hover:bg-gray-100 transition-all duration-200" onclick="location.href='/admin/logout'">
                <i class="fas fa-sign-out-alt"></i>
                <span>로그아웃</span>
            </button>
        </div>
    </header>

    <div class="flex pt-20">
        <!-- 좌측 사이드바 -->
        <aside class="fixed left-0 top-20 bottom-0 w-64 bg-white border-r border-gray-200 overflow-y-auto">
            <nav class="p-6">
                <ul class="space-y-2">
                    <li>
                        <a href="#" 
                           class="sidebar-menu-item {{ 'active' if active_tab == 'write' or not active_tab else '' }}"
                           data-tab="write">
                            <i class="fas fa-edit w-5"></i>
                            <span>글쓰기</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" 
                           class="sidebar-menu-item {{ 'active' if active_tab == 'posts' else '' }}"
                           data-tab="posts">
                            <i class="fas fa-list w-5"></i>
                            <span>글 목록 보기</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" 
                           class="sidebar-menu-item {{ 'active' if active_tab == 'settings' else '' }}"
                           data-tab="settings">
                            <i class="fas fa-cog w-5"></i>
                            <span>카테고리 관리</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- 메인 콘텐츠 -->
        <main class="flex-1 ml-64 p-8 min-h-screen">
            <!-- 글쓰기 탭 -->
            <div id="write-tab" class="tab-content {{ 'hidden' if active_tab == 'posts' else '' }}">
                <div class="bg-white rounded-lg border border-gray-200 p-8">
                    <div class="mb-8">
                        <div class="flex items-center space-x-3 mb-8">
                            <i class="fas fa-edit text-accent text-xl"></i>
                            <h2 class="text-2xl font-semibold text-text-main">새 글 작성</h2>
                        </div>
                        
                        <!-- 제목 입력 -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-main mb-2">제목</label>
                            <input type="text" 
                                   id="post-title"
                                   placeholder="제목을 입력해주세요" 
                                   class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none transition-all duration-200 bg-white">
                        </div>

                        <!-- 글 타입 선택 -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-main mb-2">글 타입</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 transition-all duration-200">
                                    <input type="radio" name="post-type" value="log" class="mr-3" onchange="updatePostType()">
                                    <div>
                                        <div class="flex items-center">
                                            <i class="fas fa-book text-blue-600 mr-2"></i>
                                            <span class="font-medium text-text-main">Martin's Log</span>
                                        </div>
                                        <p class="text-sm text-text-sub mt-1">일상 기록과 브이로그</p>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-green-50 transition-all duration-200">
                                    <input type="radio" name="post-type" value="tip" class="mr-3" onchange="updatePostType()">
                                    <div>
                                        <div class="flex items-center">
                                            <i class="fas fa-lightbulb text-green-600 mr-2"></i>
                                            <span class="font-medium text-text-main">Martin's Tip</span>
                                        </div>
                                        <p class="text-sm text-text-sub mt-1">육아 꿀팁과 노하우</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 카테고리 선택 -->
                        <div class="mb-6" id="category-section" style="display: none;">
                            <label class="block text-sm font-medium text-text-main mb-2">세부 카테고리</label>
                            <select id="post-category" 
                                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white min-w-48">
                                <option value="">세부 카테고리를 선택해주세요</option>
                            </select>
                        </div>

                        <!-- Martin's Tip 전용 필드 -->
                        <div id="tip-fields" style="display: none;">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">난이도</label>
                                    <select id="post-difficulty" 
                                            class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white w-full">
                                        <option value="쉬움">쉬움</option>
                                        <option value="보통" selected>보통</option>
                                        <option value="어려움">어려움</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">소요 시간</label>
                                    <input type="text" 
                                           id="post-time"
                                           placeholder="예: 30분, 1시간" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white">
                                </div>
                            </div>
                        </div>

                        <!-- 요약 -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-main mb-2">요약 (선택사항)</label>
                            <textarea id="post-summary" 
                                      placeholder="글의 간단한 요약을 입력해주세요" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white h-20 resize-none"></textarea>
                        </div>

                        <!-- 태그 -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium text-text-main mb-2">태그 (선택사항)</label>
                            <input type="text" 
                                   id="post-tags"
                                   placeholder="태그를 쉼표로 구분하여 입력해주세요 (예: 육아, 놀이, 일상)" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white">
                        </div>

                        <!-- 에디터 탭 -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium text-text-main mb-3">에디터 선택</label>
                            <div class="flex gap-4">
                                <button class="editor-tab active" data-editor="wysiwyg">
                                    <i class="fas fa-edit mr-2"></i>기본 입력
                                </button>
                                <button class="editor-tab" data-editor="markdown">
                                    <i class="fab fa-markdown mr-2"></i>Markdown
                                </button>
                                <button class="editor-tab" data-editor="html">
                                    <i class="fas fa-code mr-2"></i>HTML
                                </button>
                            </div>
                        </div>

                        <!-- WYSIWYG 에디터 -->
                        <div id="wysiwyg-editor" class="editor-content">
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-4 p-4 bg-gray-50 border border-gray-300 rounded-t-lg">
                                    <div class="flex gap-1">
                                        <button class="toolbar-btn" onclick="formatText('bold')" title="굵게">
                                            <i class="fas fa-bold"></i>
                                        </button>
                                        <button class="toolbar-btn" onclick="formatText('italic')" title="기울임">
                                            <i class="fas fa-italic"></i>
                                        </button>
                                        <button class="toolbar-btn" onclick="formatText('underline')" title="밑줄">
                                            <i class="fas fa-underline"></i>
                                        </button>
                                    </div>
                                    <div class="w-px h-8 bg-gray-300"></div>
                                    <div class="flex gap-1">
                                        <button class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="목록">
                                            <i class="fas fa-list-ul"></i>
                                        </button>
                                        <button class="toolbar-btn" onclick="formatText('insertOrderedList')" title="번호 목록">
                                            <i class="fas fa-list-ol"></i>
                                        </button>
                                    </div>
                                    <div class="w-px h-8 bg-gray-300"></div>
                                    <div class="flex gap-1">
                                        <button class="toolbar-btn" onclick="insertLink()" title="링크">
                                            <i class="fas fa-link"></i>
                                        </button>
                                        <button class="toolbar-btn" onclick="insertImageToEditor()" title="이미지">
                                            <i class="fas fa-image"></i>
                                        </button>
                                        <input type="file" id="editor-image-upload" accept="image/*" class="hidden" onchange="handleEditorImageUpload(event)">
                                    </div>
                                </div>
                                <div id="wysiwyg-content" 
                                     contenteditable="true" 
                                     class="min-h-96 p-6 border border-t-0 border-gray-300 rounded-b-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white"
                                     placeholder="내용을 입력하세요...">
                                </div>
                            </div>
                        </div>

                        <!-- Markdown 에디터 -->
                        <div id="markdown-editor" class="editor-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-text-main">Markdown 입력</label>
                                        <button onclick="insertMarkdownSample()" 
                                                class="px-4 py-2 text-xs bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                            샘플 삽입
                                        </button>
                                    </div>
                                    <textarea id="markdown-content" 
                                              class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none font-mono text-sm bg-white"
                                              placeholder="Markdown으로 작성하세요..."></textarea>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-text-main">미리보기</label>
                                        <button onclick="updateMarkdownPreview()" 
                                                class="px-4 py-2 text-xs bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                            새로고침
                                        </button>
                                    </div>
                                    <div id="markdown-preview" 
                                         class="h-96 p-4 border border-gray-300 rounded-lg bg-gray-50 overflow-y-auto prose prose-sm max-w-none">
                                        <p class="text-gray-500">미리보기가 여기에 표시됩니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- HTML 에디터 -->
                        <div id="html-editor" class="editor-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-text-main">HTML 코드</label>
                                        <button onclick="insertHtmlSample()" 
                                                class="px-4 py-2 text-xs bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                            샘플 삽입
                                        </button>
                                    </div>
                                    <textarea id="html-content" 
                                              class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none font-mono text-sm bg-white"
                                              placeholder="HTML 코드를 입력하세요..."></textarea>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-text-main">미리보기</label>
                                        <button onclick="updateHtmlPreview()" 
                                                class="px-4 py-2 text-xs bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                            새로고침
                                        </button>
                                    </div>
                                    <div id="html-preview" 
                                         class="h-96 p-4 border border-gray-300 rounded-lg bg-gray-50 overflow-y-auto prose prose-sm max-w-none">
                                        <p class="text-gray-500">HTML 미리보기가 여기에 표시됩니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 썸네일 이미지 업로드 -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium text-text-main mb-3">썸네일 이미지 (선택사항)</label>
                            <div class="flex items-center space-x-4 mb-4">
                                <input type="file" 
                                       id="thumbnail-upload" 
                                       accept="image/*" 
                                       class="hidden" 
                                       onchange="handleThumbnailUpload(event)">
                                <button type="button" onclick="document.getElementById('thumbnail-upload').click()" 
                                        class="flex items-center justify-center space-x-2 px-6 py-3 bg-accent text-white border border-accent rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                    <i class="fas fa-upload"></i>
                                    <span>썸네일 선택</span>
                                </button>
                                <span id="thumbnail-status" class="text-sm text-text-sub"></span>
                            </div>
                            <div id="thumbnail-preview" class="hidden">
                                <img id="thumbnail-image" src="" alt="썸네일 미리보기" class="w-32 h-20 object-cover rounded-lg border border-gray-300">
                                <input type="hidden" id="thumbnail-url" value="">
                            </div>
                        </div>

                        <!-- 하단 버튼 -->
                        <div class="flex justify-end space-x-4">
                            <button onclick="previewPost()" 
                                    class="flex items-center px-6 py-3 border border-accent text-accent rounded-lg hover:bg-accent hover:text-white transition-all duration-200 font-medium">
                                <i class="fas fa-eye mr-2"></i>미리보기
                            </button>
                            <button onclick="savePost()" 
                                    class="flex items-center px-6 py-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                <i class="fas fa-save mr-2"></i>저장하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 글 목록 탭 -->
            <div id="posts-tab" class="tab-content {{ 'hidden' if active_tab != 'posts' else '' }}">
                <div class="bg-white rounded-lg border border-gray-200 p-8">
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-list text-accent text-xl"></i>
                            <h2 class="text-2xl font-semibold text-text-main">글 목록</h2>
                        </div>
                        <a href="/admin/write" 
                           class="flex items-center px-6 py-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                            <i class="fas fa-plus mr-2"></i>새 글 작성
                        </a>
                    </div>

                    <!-- 필터 -->
                    <div class="mb-6 flex flex-wrap gap-4">
                        <select class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white">
                            <option>전체 카테고리</option>
                            <option>Martin's Log</option>
                            <option>Martin's Tip</option>
                        </select>
                        <select class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none bg-white">
                            <option>전체 상태</option>
                            <option>발행됨</option>
                            <option>임시저장</option>
                        </select>
                    </div>

                    <!-- 글 목록 테이블 -->
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-text-main">제목</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-text-main">카테고리</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-text-main">날짜</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-text-main">상태</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-text-main">작업</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                {% for post in posts_list %}
                                <tr class="hover:bg-gray-50 transition-colors duration-200">
                                    <td class="px-6 py-4">
                                        <div class="font-medium text-text-main">{{ post.title }}</div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex px-3 py-1 text-xs font-medium rounded-full 
                                                   {% if post.category == "Martin's Log" %}bg-accent/10 text-accent{% else %}bg-blue-100 text-blue-800{% endif %}">
                                            {{ post.category }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-text-sub">{{ post.date }}</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex px-3 py-1 text-xs font-medium rounded-full 
                                                   {% if post.status == '발행됨' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                            {{ post.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="flex space-x-2">
                                            <button onclick="editPost('{{ post.id }}')" 
                                                    class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center text-text-sub hover:bg-accent hover:text-white transition-all duration-200">
                                                <i class="fas fa-edit text-sm"></i>
                                            </button>
                                            <button onclick="deletePost('{{ post.id }}')" 
                                                    class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center text-text-sub hover:bg-red-500 hover:text-white transition-all duration-200">
                                                <i class="fas fa-trash text-sm"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="mt-8 flex justify-center">
                        <nav class="flex space-x-2">
                            <button class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium">이전</button>
                            <button class="px-4 py-2 text-sm bg-accent text-white rounded-lg font-medium">1</button>
                            <button class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium">2</button>
                            <button class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium">3</button>
                            <button class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium">다음</button>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- 카테고리 관리 탭 -->
            <div id="settings-tab" class="tab-content {{ 'hidden' if active_tab != 'settings' else '' }}">
                <div class="bg-white rounded-lg border border-gray-200 p-8">
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-cog text-accent text-xl"></i>
                            <h2 class="text-2xl font-semibold text-text-main">카테고리 관리</h2>
                        </div>
                    </div>

                    <!-- Martin's Log 카테고리 관리 -->
                    <div class="mb-12">
                        <div class="flex items-center space-x-3 mb-6">
                            <i class="fas fa-book text-accent text-lg"></i>
                            <h3 class="text-xl font-semibold text-text-main">Martin's Log 카테고리</h3>
                        </div>
                        
                        <!-- 현재 Log 카테고리 목록 -->
                        <div class="mb-6">
                            <div id="log-categories-list" class="space-y-4">
                                {% if categories %}
                                    {% for category_id, category in categories.items() %}
                                        {% if category.type == 'log' %}
                                        <div class="border border-gray-200 rounded-lg p-4 bg-blue-50" data-category-id="{{ category_id }}">
                                            <div class="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 class="font-semibold text-text-main">{{ category.name }}</h4>
                                                    <p class="text-sm text-text-sub">{{ category.description }}</p>
                                                    <p class="text-xs text-text-sub mt-1">ID: {{ category_id }}</p>
                                                </div>
                                                <button onclick="deleteCategory('{{ category_id }}')" 
                                                        class="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-all duration-200">
                                                    <i class="fas fa-trash text-sm"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- 새 Log 카테고리 추가 -->
                        <div class="border border-blue-200 rounded-lg p-6 bg-blue-50">
                            <h4 class="text-lg font-semibold text-text-main mb-4">새 Log 카테고리 추가</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">카테고리 ID</label>
                                    <input type="text" 
                                           id="new-log-category-id" 
                                           placeholder="예: daily-life" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none">
                                    <p class="text-xs text-text-sub mt-1">영문, 숫자, 하이픈만 사용 가능</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">카테고리 이름</label>
                                    <input type="text" 
                                           id="new-log-category-name" 
                                           placeholder="예: 일상 기록" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-text-main mb-2">설명 (선택사항)</label>
                                <textarea id="new-log-category-description" 
                                          placeholder="카테고리에 대한 설명을 입력해주세요" 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none h-20 resize-none"></textarea>
                            </div>
                            <button onclick="addLogCategory()" 
                                    class="px-6 py-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                <i class="fas fa-plus mr-2"></i>Log 카테고리 추가
                            </button>
                        </div>
                    </div>

                    <!-- Martin's Tip 카테고리 관리 -->
                    <div class="mb-8">
                        <div class="flex items-center space-x-3 mb-6">
                            <i class="fas fa-lightbulb text-accent text-lg"></i>
                            <h3 class="text-xl font-semibold text-text-main">Martin's Tip 카테고리</h3>
                        </div>
                        
                        <!-- 현재 Tip 카테고리 목록 -->
                        <div class="mb-6">
                            <div id="tip-categories-list" class="space-y-4">
                                {% if categories %}
                                    {% for category_id, category in categories.items() %}
                                        {% if category.type == 'tip' %}
                                        <div class="border border-gray-200 rounded-lg p-4 bg-green-50" data-category-id="{{ category_id }}">
                                            <div class="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 class="font-semibold text-text-main">{{ category.name }}</h4>
                                                    <p class="text-sm text-text-sub">{{ category.description }}</p>
                                                    <p class="text-xs text-text-sub mt-1">ID: {{ category_id }}</p>
                                                </div>
                                                <button onclick="deleteCategory('{{ category_id }}')" 
                                                        class="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-all duration-200">
                                                    <i class="fas fa-trash text-sm"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- 새 Tip 카테고리 추가 -->
                        <div class="border border-green-200 rounded-lg p-6 bg-green-50">
                            <h4 class="text-lg font-semibold text-text-main mb-4">새 Tip 카테고리 추가</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">카테고리 ID</label>
                                    <input type="text" 
                                           id="new-tip-category-id" 
                                           placeholder="예: parenting-tips" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none">
                                    <p class="text-xs text-text-sub mt-1">영문, 숫자, 하이픈만 사용 가능</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-main mb-2">카테고리 이름</label>
                                    <input type="text" 
                                           id="new-tip-category-name" 
                                           placeholder="예: 육아 꿀팁" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-text-main mb-2">설명 (선택사항)</label>
                                <textarea id="new-tip-category-description" 
                                          placeholder="카테고리에 대한 설명을 입력해주세요" 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent outline-none h-20 resize-none"></textarea>
                            </div>
                            <button onclick="addTipCategory()" 
                                    class="px-6 py-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition-all duration-200 font-medium">
                                <i class="fas fa-plus mr-2"></i>Tip 카테고리 추가
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 미리보기 모달 -->
    <div id="preview-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 backdrop-blur-sm">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto border border-gray-200">
                <div class="flex justify-between items-center p-6 border-b border-gray-200 bg-gray-50">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-eye text-accent"></i>
                        <h3 class="text-lg font-semibold text-text-main">미리보기</h3>
                    </div>
                    <button onclick="closePreview()" class="w-8 h-8 rounded-lg bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-text-sub hover:text-text-main transition-all duration-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="preview-content" class="p-6 prose max-w-none bg-white">
                    <!-- 미리보기 내용이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <style>
        .sidebar-menu-item {
            @apply flex items-center space-x-3 px-4 py-3 text-text-sub rounded-lg hover:bg-gray-100 hover:text-text-main transition-all duration-200 font-medium;
        }
        
        .sidebar-menu-item.active {
            @apply bg-accent text-white;
        }
        
        .editor-tab {
            @apply px-4 py-2 text-sm font-medium text-text-sub bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-text-main transition-all duration-200;
        }
        
        .editor-tab.active {
            @apply bg-accent text-white border-accent;
        }
        
        .toolbar-btn {
            @apply w-8 h-8 flex items-center justify-center text-text-sub hover:text-accent hover:bg-gray-100 border border-gray-300 rounded-lg transition-all duration-200;
        }
        
        .prose h1 { @apply text-2xl font-semibold mb-4 text-text-main; }
        .prose h2 { @apply text-xl font-semibold mb-3 text-text-main; }
        .prose h3 { @apply text-lg font-semibold mb-2 text-text-main; }
        .prose p { @apply mb-4 text-text-main; }
        .prose ul { @apply list-disc list-inside mb-4 text-text-main; }
        .prose ol { @apply list-decimal list-inside mb-4 text-text-main; }
        .prose blockquote { @apply border-l-4 border-accent pl-4 italic mb-4 bg-gray-50 py-2 rounded-r-lg; }
        .prose code { @apply bg-gray-100 px-2 py-1 rounded text-sm font-mono; }
        .prose pre { @apply bg-gray-100 p-4 rounded-lg overflow-x-auto mb-4 border border-gray-200; }
    </style>

    <script>
        // 전역 변수
        let categoriesData = {};
        
        // 페이지 로드 시 카테고리 데이터 가져오기
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/categories')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        categoriesData = data.categories;
                    }
                })
                .catch(error => console.error('Error loading categories:', error));
        });

        // 메인 탭 전환 (사이드바)
        document.querySelectorAll('.sidebar-menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const tabName = this.dataset.tab;
                
                if (tabName) {
                    // 사이드바 활성화 상태 변경
                    document.querySelectorAll('.sidebar-menu-item').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 탭 콘텐츠 전환
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    const targetTab = document.getElementById(tabName + '-tab');
                    if (targetTab) {
                        targetTab.classList.remove('hidden');
                    }
                }
            });
        });

        // 에디터 탭 전환
        document.querySelectorAll('.editor-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const editorType = this.dataset.editor;
                
                // 탭 활성화 상태 변경
                document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // 에디터 콘텐츠 전환
                document.querySelectorAll('.editor-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(editorType + '-editor').classList.remove('hidden');
            });
        });

        // 카테고리 변경 시 서브카테고리 업데이트
        function updateSubcategories() {
            const categorySelect = document.getElementById('post-category');
            const subcategorySection = document.getElementById('subcategory-section');
            const subcategorySelect = document.getElementById('post-subcategory');
            const tipFields = document.getElementById('tip-fields');
            
            const selectedCategory = categorySelect.value;
            
            // 서브카테고리 초기화
            subcategorySelect.innerHTML = '<option value="">서브카테고리를 선택해주세요</option>';
            
            if (selectedCategory && categoriesData[selectedCategory]) {
                // 서브카테고리 섹션 표시
                subcategorySection.style.display = 'block';
                
                // 서브카테고리 옵션 추가
                categoriesData[selectedCategory].subcategories.forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory;
                    option.textContent = subcategory;
                    subcategorySelect.appendChild(option);
                });
                
                // Martin's Tip인 경우 추가 필드 표시
                if (selectedCategory === 'martins-tip') {
                    tipFields.style.display = 'block';
                } else {
                    tipFields.style.display = 'none';
                }
            } else {
                subcategorySection.style.display = 'none';
                tipFields.style.display = 'none';
            }
        }

        // WYSIWYG 에디터 기능
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('wysiwyg-content').focus();
        }

        function insertLink() {
            const url = prompt('링크 URL을 입력하세요:');
            if (url) {
                document.execCommand('createLink', false, url);
            }
        }

        function insertImageToEditor() {
            document.getElementById('editor-image-upload').click();
        }

        // 에디터용 이미지 업로드
        function handleEditorImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);
                
                fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 현재 활성 에디터에 이미지 삽입
                        const activeTab = document.querySelector('.editor-tab.active').dataset.editor;
                        
                        if (activeTab === 'wysiwyg') {
                            document.execCommand('insertImage', false, data.file_url);
                        } else if (activeTab === 'markdown') {
                            const markdown = document.getElementById('markdown-content');
                            markdown.value += `\n![${data.filename}](${data.file_url})\n`;
                            updateMarkdownPreview();
                        } else if (activeTab === 'html') {
                            const html = document.getElementById('html-content');
                            html.value += `\n<img src="${data.file_url}" alt="${data.filename}">\n`;
                            updateHtmlPreview();
                        }
                        
                        alert('이미지가 성공적으로 삽입되었습니다.');
                    } else {
                        alert('이미지 업로드 실패: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('이미지 업로드 중 오류가 발생했습니다.');
                });
            }
        }

        // 썸네일 업로드
        function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);
                
                document.getElementById('thumbnail-status').textContent = '업로드 중...';
                
                fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('thumbnail-status').textContent = '업로드 완료';
                        document.getElementById('thumbnail-url').value = data.file_url;
                        document.getElementById('thumbnail-image').src = data.file_url;
                        document.getElementById('thumbnail-preview').classList.remove('hidden');
                    } else {
                        document.getElementById('thumbnail-status').textContent = '업로드 실패: ' + data.message;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('thumbnail-status').textContent = '업로드 중 오류 발생';
                });
            }
        }

        // 마크다운 기능
        function insertMarkdownSample() {
            const sample = `# 제목

## 부제목

**굵은 글씨**와 *기울임 글씨*를 사용할 수 있습니다.

- 목록 항목 1
- 목록 항목 2
- 목록 항목 3

> 인용문입니다.

\`\`\`javascript
console.log('코드 블록');
\`\`\`

[링크 텍스트](https://example.com)`;
            
            document.getElementById('markdown-content').value = sample;
            updateMarkdownPreview();
        }

        function updateMarkdownPreview() {
            const markdown = document.getElementById('markdown-content').value;
            const html = marked.parse(markdown);
            document.getElementById('markdown-preview').innerHTML = html;
        }

        // 마크다운 실시간 미리보기
        document.getElementById('markdown-content').addEventListener('input', function() {
            updateMarkdownPreview();
        });

        // HTML 기능
        function insertHtmlSample() {
            const sample = `<h1>제목</h1>

<h2>부제목</h2>

<p><strong>굵은 글씨</strong>와 <em>기울임 글씨</em>를 사용할 수 있습니다.</p>

<ul>
    <li>목록 항목 1</li>
    <li>목록 항목 2</li>
    <li>목록 항목 3</li>
</ul>

<blockquote>
    <p>인용문입니다.</p>
</blockquote>

<pre><code>console.log('코드 블록');</code></pre>

<p><a href="https://example.com">링크 텍스트</a></p>

<img src="https://via.placeholder.com/300x200" alt="샘플 이미지">`;
            
            document.getElementById('html-content').value = sample;
            updateHtmlPreview();
        }

        function updateHtmlPreview() {
            const htmlCode = document.getElementById('html-content').value;
            document.getElementById('html-preview').innerHTML = htmlCode;
        }

        // HTML 실시간 미리보기
        document.getElementById('html-content').addEventListener('input', function() {
            updateHtmlPreview();
        });

        // 이미지 업로드 처리
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    document.getElementById('upload-status').textContent = `업로드됨: ${file.name}`;
                    
                    // 현재 활성 에디터에 이미지 삽입
                    const activeTab = document.querySelector('.editor-tab.active').dataset.editor;
                    
                    if (activeTab === 'wysiwyg') {
                        document.execCommand('insertImage', false, imageUrl);
                    } else if (activeTab === 'markdown') {
                        const markdown = document.getElementById('markdown-content');
                        markdown.value += `\n![${file.name}](${imageUrl})\n`;
                        updateMarkdownPreview();
                    } else if (activeTab === 'html') {
                        const html = document.getElementById('html-content');
                        html.value += `\n<img src="${imageUrl}" alt="${file.name}">\n`;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // 미리보기 기능
        function previewPost() {
            const title = document.getElementById('post-title').value;
            const category = document.getElementById('post-category').value;
            const activeTab = document.querySelector('.editor-tab.active').dataset.editor;
            
            let content = '';
            
            if (activeTab === 'wysiwyg') {
                content = document.getElementById('wysiwyg-content').innerHTML;
            } else if (activeTab === 'markdown') {
                const markdown = document.getElementById('markdown-content').value;
                content = marked.parse(markdown);
            } else if (activeTab === 'html') {
                content = document.getElementById('html-content').value;
            }
            
            const previewHtml = `
                <h1 class="text-3xl font-bold mb-4">${title || '제목 없음'}</h1>
                <div class="mb-4">
                    <span class="inline-block px-3 py-1 text-sm font-semibold rounded-full ${category === 'martins-log' ? 'bg-pink-100 text-pink-800' : 'bg-blue-100 text-blue-800'}">
                        ${category === 'martins-log' ? "Martin's Log" : category === 'martins-tip' ? "Martin's Tip" : '카테고리 미선택'}
                    </span>
                </div>
                <div class="prose max-w-none">${content}</div>
            `;
            
            document.getElementById('preview-content').innerHTML = previewHtml;
            document.getElementById('preview-modal').classList.remove('hidden');
        }

        function closePreview() {
            document.getElementById('preview-modal').classList.add('hidden');
        }

        // 저장 기능
        function savePost() {
            const title = document.getElementById('post-title').value;
            const selectedType = document.querySelector('input[name="post-type"]:checked');
            const category = document.getElementById('post-category').value;
            const summary = document.getElementById('post-summary').value;
            const tags = document.getElementById('post-tags').value;
            const thumbnail = document.getElementById('thumbnail-url').value;
            const activeTab = document.querySelector('.editor-tab.active').dataset.editor;
            
            if (!title.trim()) {
                alert('제목을 입력해주세요.');
                return;
            }
            
            if (!selectedType) {
                alert('글 타입(Martin\'s Log 또는 Martin\'s Tip)을 선택해주세요.');
                return;
            }
            
            if (!category) {
                alert('세부 카테고리를 선택해주세요.');
                return;
            }
            
            let content = '';
            if (activeTab === 'wysiwyg') {
                content = document.getElementById('wysiwyg-content').innerHTML;
            } else if (activeTab === 'markdown') {
                content = document.getElementById('markdown-content').value;
            } else if (activeTab === 'html') {
                content = document.getElementById('html-content').value;
            }
            
            if (!content.trim()) {
                alert('내용을 입력해주세요.');
                return;
            }
            
            // 포스트 데이터 구성
            const postData = {
                title: title.trim(),
                category: category,
                content: content,
                summary: summary.trim(),
                thumbnail: thumbnail,
                tags: tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [],
                editor_type: activeTab,
                status: '발행됨',
                post_type: selectedType.value
            };
            
            // Martin's Tip 전용 필드 추가
            if (selectedType.value === 'tip') {
                postData.difficulty = document.getElementById('post-difficulty').value;
                postData.time = document.getElementById('post-time').value;
            }
            
            // 서버로 전송
            fetch('/api/save-post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('글이 성공적으로 저장되었습니다!');
                    // 폼 초기화
                    resetForm();
                } else {
                    alert('저장 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('저장 중 오류가 발생했습니다.');
            });
        }
        
        // 폼 초기화
        function resetForm() {
            document.getElementById('post-title').value = '';
            document.getElementById('post-category').value = '';
            document.getElementById('post-summary').value = '';
            document.getElementById('post-tags').value = '';
            document.getElementById('post-difficulty').value = '보통';
            document.getElementById('post-time').value = '';
            document.getElementById('wysiwyg-content').innerHTML = '';
            document.getElementById('markdown-content').value = '';
            document.getElementById('html-content').value = '';
            document.getElementById('thumbnail-url').value = '';
            
            // 라디오 버튼 초기화
            document.querySelectorAll('input[name="post-type"]').forEach(radio => {
                radio.checked = false;
            });
            
            // 섹션 숨기기
            document.getElementById('category-section').style.display = 'none';
            document.getElementById('tip-fields').style.display = 'none';
            
            // 썸네일 관련 초기화
            const thumbnailPreview = document.getElementById('thumbnail-preview');
            const thumbnailStatus = document.getElementById('thumbnail-status');
            if (thumbnailPreview) thumbnailPreview.classList.add('hidden');
            if (thumbnailStatus) thumbnailStatus.textContent = '';
        }

        // 글 타입 변경 시 호출
        function updatePostType() {
            const selectedType = document.querySelector('input[name="post-type"]:checked');
            const categorySection = document.getElementById('category-section');
            const tipFields = document.getElementById('tip-fields');
            const categorySelect = document.getElementById('post-category');
            
            if (selectedType) {
                categorySection.style.display = 'block';
                
                // 카테고리 옵션 업데이트
                categorySelect.innerHTML = '<option value="">세부 카테고리를 선택해주세요</option>';
                
                // 해당 타입의 카테고리만 표시
                Object.entries(categoriesData).forEach(([id, category]) => {
                    if (category.type === selectedType.value) {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = category.name;
                        categorySelect.appendChild(option);
                    }
                });
                
                // Martin's Tip 선택 시 추가 필드 표시
                if (selectedType.value === 'tip') {
                    tipFields.style.display = 'block';
                } else {
                    tipFields.style.display = 'none';
                }
            } else {
                categorySection.style.display = 'none';
                tipFields.style.display = 'none';
            }
        }

        // Log 카테고리 추가
        function addLogCategory() {
            const categoryId = document.getElementById('new-log-category-id').value.trim();
            const categoryName = document.getElementById('new-log-category-name').value.trim();
            const categoryDescription = document.getElementById('new-log-category-description').value.trim();
            
            if (!categoryId || !categoryName) {
                alert('카테고리 ID와 이름은 필수입니다.');
                return;
            }
            
            // ID 유효성 검사 (영문, 숫자, 하이픈만)
            if (!/^[a-z0-9-]+$/.test(categoryId)) {
                alert('카테고리 ID는 영문 소문자, 숫자, 하이픈만 사용할 수 있습니다.');
                return;
            }
            
            const categoryData = {
                id: categoryId,
                name: categoryName,
                description: categoryDescription,
                type: 'log'
            };
            
            fetch('/api/categories', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(categoryData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Log 카테고리가 추가되었습니다.');
                    location.reload();
                } else {
                    alert('카테고리 추가 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('카테고리 추가 중 오류가 발생했습니다.');
            });
        }

        // Tip 카테고리 추가
        function addTipCategory() {
            const categoryId = document.getElementById('new-tip-category-id').value.trim();
            const categoryName = document.getElementById('new-tip-category-name').value.trim();
            const categoryDescription = document.getElementById('new-tip-category-description').value.trim();
            
            if (!categoryId || !categoryName) {
                alert('카테고리 ID와 이름은 필수입니다.');
                return;
            }
            
            // ID 유효성 검사 (영문, 숫자, 하이픈만)
            if (!/^[a-z0-9-]+$/.test(categoryId)) {
                alert('카테고리 ID는 영문 소문자, 숫자, 하이픈만 사용할 수 있습니다.');
                return;
            }
            
            const categoryData = {
                id: categoryId,
                name: categoryName,
                description: categoryDescription,
                type: 'tip'
            };
            
            fetch('/api/categories', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(categoryData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Tip 카테고리가 추가되었습니다.');
                    location.reload();
                } else {
                    alert('카테고리 추가 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('카테고리 추가 중 오류가 발생했습니다.');
            });
        }
        
        function deleteCategory(categoryId) {
            if (confirm('정말로 이 카테고리를 삭제하시겠습니까?')) {
                fetch(`/api/categories/${categoryId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('카테고리가 삭제되었습니다.');
                        location.reload();
                    } else {
                        alert('카테고리 삭제 실패: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('카테고리 삭제 중 오류가 발생했습니다.');
                });
            }
        }
        
        function addSubcategory(categoryId) {
            const inputId = `subcategory-input-${categoryId}`;
            const subcategory = document.getElementById(inputId).value.trim();
            
            if (!subcategory) {
                alert('서브카테고리 이름을 입력해주세요.');
                return;
            }
            
            fetch(`/api/categories/${categoryId}/subcategories`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ subcategory: subcategory })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('서브카테고리가 추가되었습니다.');
                    location.reload();
                } else {
                    alert('서브카테고리 추가 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('서브카테고리 추가 중 오류가 발생했습니다.');
            });
        }
        
        function removeSubcategory(categoryId, subcategory) {
            if (confirm(`'${subcategory}' 서브카테고리를 삭제하시겠습니까?`)) {
                // 서브카테고리 삭제 API 구현 필요
                alert('서브카테고리 삭제 기능은 아직 구현되지 않았습니다.');
            }
        }

        // 글 편집/삭제 기능
        function editPost(id) {
            alert(`글 ID ${id}를 편집합니다.`);
            // 실제로는 해당 글 데이터를 불러와서 에디터에 표시
        }

        function deletePost(id) {
            if (confirm('정말로 이 글을 삭제하시겠습니까?')) {
                fetch(`/api/posts/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('글이 삭제되었습니다.');
                        location.reload();
                    } else {
                        alert('글 삭제 실패: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('글 삭제 중 오류가 발생했습니다.');
                });
            }
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('preview-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePreview();
            }
        });
    </script>
</body>
</html> 